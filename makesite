#!/bin/bash
# Written by M. De Graef; 10/11/18
# Project Funding: NSF DMR-1564550
#
# This script is Mac OS X specific... but might work on Linux with minor modifications
#
# This script is the top level script for building all the Magnetic Point Group web site files 
# It should be called simply as follows:
#
# ./makesite
#
# All options should be set in the WebSiteParameters file before running this script.
# To edit this file, first copy it from the WebSiteParameters.template file, and then edit the
# parameters for your site.

echo ""
date
echo ""
echo "Please note that the web files generated by this script will need to be accessed via a properly"
echo "installed web server.  The files use a number of scripts that will cause javascript security issues "
echo "when the index.html file is opened directly in a browser... the dropdown menus will almost certainly"
echo "not work correctly when opening the file from your local drive.  They only work when served via a "
echo "web server."
echo ""

# -------------------------------------------------------
WEB_FILE="WebSiteParameters"
if [ -f $WEB_FILE ]; then
    . $WEB_FILE
else
    echo "$WEB_FILE not found; exiting"
    exit
fi

CURDIR=`pwd`

# do we need to create the WEBSITE_FOLDER?
if [ -e "$WEBSITE_FOLDER" ] 
  then 
    echo "$WEBSITE_FOLDER already exists"
  else
    mkdir $WEBSITE_FOLDER
fi

# define the subfolders and then create them
HTML_FOLDER=$WEBSITE_FOLDER/html
STILLS_FOLDER=$WEBSITE_FOLDER/stills
MOVIES_FOLDER=$WEBSITE_FOLDER/movies
ARCHIVE_FOLDER=$WEBSITE_FOLDER/mpgarchive
LABEL_FOLDER=$WEBSITE_FOLDER/pglabels
mkdir $HTML_FOLDER
mkdir $STILLS_FOLDER
mkdir $MOVIES_FOLDER
mkdir $ARCHIVE_FOLDER
mkdir $LABEL_FOLDER

cd htmlgen

# place the main index.html file
echo "Generating $WEBSITE_FOLDER/index.html"
cp index.html "$WEBSITE_FOLDER"/index.html

# place the intro.html file
echo "Generating $HTML_FOLDER/intro.html"
cp intro.html "$HTML_FOLDER"/intro.html

# place the contacts.html file
echo "Generating $HTML_FOLDER/contacts.html"
cp contacts.html "$HTML_FOLDER"/contacts.html

# place the archives.html file
echo "Generating $HTML_FOLDER/archives.html"
cp archives.html "$HTML_FOLDER"/archives.html

# generate the navigation dropdown menus
echo "Generating navigation dropdown menus in $WEBSITE_FOLDER/menubar.html"
./mkall >"$WEBSITE_FOLDER"/menubar.html

### TO BE WRITTEN:  INITIALIZE THE TEMPLATE FILES FOR THE INDIVIDUAL PAGES WITH THE CORRECT IMAGE DIMENSIONS

cd pages
# generate the still and movie html files for all point groups and representation modes
echo "Generating all individual stills and movie pages in $HTML_FOLDER"
./mkallpages $HTML_FOLDER

cd ..




# then extract all the archive files into the correct folders



# final cleanup
cd $TMP_FOLDER
rm -f .* * *.* >/dev/null 2>/dev/null
cd $CURDIR
rmdir $TMP_FOLDER

cd $FRAMES_FOLDER
rm -f .* * *.* >/dev/null 2>/dev/null
cd $CURDIR
rmdir $FRAMES_FOLDER

echo "- - - - - - - - - - - - - - - - - - - - - - - - - "
echo "All is well that ends well ..."
showdate
exit
